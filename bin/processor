#!/usr/bin/env ruby
# encoding: UTF-8

require "optparse"

require "deep-connect/deep-connect"

require "fairy/share/conf"
require "fairy/processor"

$0 = "fairy processor #{ARGV.join(' ')}"

Thread.abort_on_exception = Fairy::CONF.DEBUG_THREAD_ABORT_ON_EXCEPTION

if Fairy::CONF.USE_RESOLV_REPLACE
  require "resolv-replace"
end

node_port = nil
id = nil
trace=false
opt = OptionParser.new do |opt|
  opt.on("--node=VAL"){|val| node_port = val}
  opt.on("--id=VAL"){|val| id = val}
  opt.on("--tracer"){ trace = true}
end
opt.parse!(ARGV)

Fairy::Processor.start(id.to_i, node_port)

if trace
   puts "Trace On"
   require "share/tr"
end

sleep

